## **株管理アプリ 外部設計書**

### **1. システム概要**

本システムは、ユーザーが複数の株を効率的に管理できるよう、株の情報登録・管理、目標達成度の可視化、株価履歴管理、取引履歴の記録、およびアラート通知機能を提供します。また、外部 API を使用してリアルタイムの株価更新をサポートします。

---

### **2. インターフェース設計**

#### **2.1 ユーザーインターフェース（UI）**

ユーザーインターフェースは React を使用して構築され、直感的に操作できるデザインを採用しています。主な画面は以下の通りです：

- **株情報管理画面**  
  ユーザーが保有する株式を登録、編集、削除する画面。銘柄シンボル、購入価格、株数、目標価格、損切り価格などを入力して管理します。

- **株価閲覧画面**  
  各株式の最新株価および価格変動を表示する画面。

- **目標達成状況画面**  
  設定した目標価格や損切り価格に対する進捗をグラフで可視化。

- **取引履歴画面**  
  株式の売買履歴を時系列で一覧表示。

- **アラート通知画面**  
  設定した目標価格や損切り価格に達した場合の通知を一覧表示。

---

#### **2.2 API インターフェース**

外部 API を利用して株価情報や分析指標を取得します：

- **Yahoo Finance API**: 株価および過去の株価データの取得。
- **Alpha Vantage API**: テクニカル指標（MACD、RSI）の取得。

##### **サンプル API 設計**

以下は Yahoo Finance API を利用した株価取得の例です：

- **エンドポイント**: `https://query1.finance.yahoo.com/v7/finance/quote`
- **リクエストパラメータ**:
  - `symbols`: 銘柄シンボル（例: "AAPL"）
- **レスポンス形式**: JSON
- **レスポンス例**:
  ```json
  {
    "quoteResponse": {
      "result": [
        {
          "symbol": "AAPL",
          "regularMarketPrice": 150.1,
          "regularMarketChangePercent": 1.2
        }
      ]
    }
  }
  ```

---

#### **2.3 データベース設計**

1. **ユーザー情報エンティティ**

   - **目的**: アプリケーションを利用するユーザーの認証情報および基本プロファイル情報を管理します。
   - **主なデータ**: ユーザー ID、認証情報（メールアドレス、パスワード）、ユーザー名、アカウント作成日など。

2. **保有株情報エンティティ**

   - **目的**: ユーザーが保有する株式に関するデータを管理します。
   - **主なデータ**: 保有株 ID、銘柄シンボル、購入情報（購入価格、購入日時）、保有数量、目標売却価格など。

3. **取引履歴エンティティ**

   - **目的**: ユーザーが行った株式取引（売買）の履歴を記録します。
   - **主なデータ**: 取引 ID、対象株式、取引タイプ（購入または売却）、取引数量、取引価格、取引日時など。

4. **目標管理エンティティ**

   - **目的**: ユーザーが設定した目標（資産額や期限）を管理します。
   - **主なデータ**: 目標 ID、目標額、目標達成予定日、進捗率、関連する株式情報など。

5. **配当情報エンティティ**

   - **目的**: ユーザーが保有する株式から得られる配当金情報を記録します。
   - **主なデータ**: 配当 ID、関連株式、配当金額、配当支払日など。

6. **テクニカル指標エンティティ**
   - **目的**: 株式の分析に使用するテクニカル指標データ（MACD、RSI など）を記録します。
   - **主なデータ**: 指標 ID、対象株式、計算結果、算出日時など。

---

#### **2.4 バックエンド API 設計**

バックエンドは Java + Spring Boot を使用して構築されます。主な API の例：

- **株情報登録 API**

  - **エンドポイント**: `POST /api/stocks`
  - **リクエスト例**:
    ```json
    {
      "symbol": "AAPL",
      "purchase_price": 145.5,
      "quantity": 100,
      "target_price": 150.0,
      "stop_loss_price": 140.0
    }
    ```
  - **レスポンス例**:
    ```json
    {
      "stock_id": 1,
      "symbol": "AAPL",
      "purchase_price": 145.5,
      "quantity": 100,
      "target_price": 150.0,
      "stop_loss_price": 140.0
    }
    ```

- **株価履歴取得 API**
  - **エンドポイント**: `GET /api/stocks/{stock_id}/history`
  - **レスポンス例**:
    ```json
    [
      {
        "date": "2024-11-20",
        "price": 150.1
      },
      {
        "date": "2024-11-19",
        "price": 148.2
      }
    ]
    ```

---

### **3. セキュリティ設計**

- **JWT 認証**: 各 API の利用時に JWT トークンを使用して認証を行います。
- **パスワードハッシュ化**: パスワードはハッシュ化して保存（例: bcrypt）。

---

### **4. アラート通知**

- **通知トリガー**: 株価が目標価格または損切り価格に達した際に通知。
- **通知方法**: WebSocket を利用したリアルタイム通知。
