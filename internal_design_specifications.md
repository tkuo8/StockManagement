### 株管理アプリ 内部設計書

#### 1. システムアーキテクチャ

システムは、フロントエンド、バックエンド、データベース、外部 API の 4 つの主要なコンポーネントから成り立っています。

- **フロントエンド (React + Bootstrap)**

  - **UI/UX**: ユーザーインターフェースは React を使い、ユーザーが直感的に操作できるようにデザインします。Bootstrap を使用してレスポンシブデザインを実現します。
  - **状態管理**: React の Context API または Redux を使用して、アプリケーション全体の状態管理を行います。例えば、ユーザーの株情報、目標進捗、アラート状態などを管理します。

- **バックエンド (Java + Spring Boot)**

  - **API サーバー**: RESTful API を提供する Spring Boot アプリケーションを使用します。ユーザーからのリクエストに応じて、データの取得、更新、削除を行います。
  - **株情報の取得・管理**: ユーザーの株情報や目標設定を管理し、リアルタイムで株価データを取得する機能を提供します。
  - **テクニカル指標の計算**: Alpha Vantage API を使用し、MACD や RSI などのテクニカル指標を計算し、売買タイミングを分析します。

- **データベース (MySQL)**

  - **データ管理**: 株情報、目標設定、売買履歴などを管理するために、MySQL を使用します。データベースは、各テーブル間のリレーションを保ちつつ、整合性を維持します。

- **外部 API**
  - **Yahoo Finance API**: 株価、履歴データを取得するために使用します。無料プランで提供されており、株価のリアルタイム情報を取得します。
  - **Alpha Vantage API**: テクニカル指標（MACD、RSI など）を取得するために利用します。これにより、株の売買タイミングをデータに基づいて分析します。
  - **Quandl API**: 経済指標や株価の追加情報を取得するために使用します。

#### 2. データベース設計

- **テーブル設計**

  1. **ユーザーテーブル (`users`)**

     - `id`: ユーザーの一意の識別子 (PK)
     - `username`: ユーザー名
     - `password`: パスワード（ハッシュ化）
     - `email`: ユーザーのメールアドレス
     - `created_at`: アカウント作成日時
     - `updated_at`: アカウント更新日時

  2. **株情報テーブル (`stocks`)**

     - `id`: 銘柄の一意の識別子 (PK)
     - `user_id`: ユーザー ID（外部キー）
     - `symbol`: 銘柄のティッカーシンボル（例: AAPL, TSLA）
     - `quantity`: 保有株数
     - `purchase_price`: 購入価格
     - `goal_price`: 目標売却価格
     - `created_at`: 登録日時
     - `updated_at`: 更新日時

  3. **売買履歴テーブル (`trade_history`)**

     - `id`: 売買履歴の一意の識別子 (PK)
     - `stock_id`: 株情報 ID（外部キー）
     - `trade_type`: 売買のタイプ（buy / sell）
     - `quantity`: 売買株数
     - `price`: 売買時の価格
     - `trade_date`: 売買日時
     - `created_at`: 登録日時

  4. **目標設定テーブル (`goals`)**

     - `id`: 目標の一意の識別子 (PK)
     - `user_id`: ユーザー ID（外部キー）
     - `goal_amount`: 目標額
     - `target_date`: 目標達成日
     - `progress`: 現在の進捗
     - `created_at`: 登録日時
     - `updated_at`: 更新日時

  5. **配当情報テーブル (`dividends`)**
     - `id`: 配当情報の一意の識別子 (PK)
     - `stock_id`: 銘柄 ID（外部キー）
     - `dividend_amount`: 配当額
     - `payment_date`: 支払い日
     - `created_at`: 登録日時

#### 3. サービス層設計

- **株情報管理**

  - **株情報の登録・更新・削除**: ユーザーが保有する株の情報を管理し、MySQL データベースに保存します。API を通じて CRUD 操作を提供します。
  - **株価情報の取得**: Yahoo Finance API を利用し、指定された銘柄の最新の株価情報を取得します。

- **目標設定管理**

  - **目標設定の作成・更新**: ユーザーが設定した目標額や目標達成日時を管理し、進捗状況を更新します。
  - **目標達成度の計算**: 目標金額と現状の資産を比較し、達成度を表示します。

- **テクニカル分析**

  - **MACD、RSI の取得**: Alpha Vantage API を利用して、指定銘柄のテクニカル指標を取得します。取得したデータを基に売買タイミングを分析します。

- **アラート通知**
  - **目標到達通知**: 株価が設定した目標に達したときにリアルタイムで通知します。
  - **損切りライン通知**: 損切りラインに達した際にも通知を行い、ユーザーが迅速に対応できるようにします。

#### 4. フロントエンド設計

- **React コンポーネント**

  - **株一覧ページ**: 登録されている株情報を一覧表示し、株の詳細情報や売買履歴を表示します。
  - **目標管理ページ**: ユーザーが設定した目標額や進捗を表示します。
  - **株情報入力フォーム**: 新規銘柄の登録・編集フォームを提供します。
  - **アラート管理ページ**: アラート通知の履歴や設定を管理するページです。

- **API 通信**
  - **RESTful API**を使用して、バックエンドとのデータ通信を行います。ユーザーが行った操作（株情報の更新、目標設定など）をサーバーに送信し、結果をフロントエンドに表示します。

#### 5. セキュリティ設計

- **ユーザー認証**: JWT を利用し、ユーザー認証を実施します。ログイン後に JWT トークンを発行し、これを使用して API へのアクセスを制限します。
- **データ保護**: ユーザーのパスワードはハッシュ化して保存し、個人情報を安全に管理します。
- **アクセス制御**: ユーザーごとにアクセスできるデータ範囲を制限します。

#### 6. エラーハンドリング

- **バックエンドエラー**: API が失敗した場合、適切な HTTP ステータスコードとエラーメッセージを返します（例: 400 Bad Request、404 Not Found、500 Internal Server Error）。
- **フロントエンドエラー**: ユーザー操作ミスや API エラーに対して適切なエラーメッセージを表示し、再試行できるようにします。

#### 7. テスト

- **ユニットテスト**: バックエンドおよびフロントエンドで主要な機能（株情報の取得・更新、目標達成度計算など）についてユニットテストを実施します。
- **統合テスト**: バックエンドとフロントエンドが連携した動作を確認するための統合テストを行います。
